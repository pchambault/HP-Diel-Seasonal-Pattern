---
title: "Figures selection for HP paper"
author: "Philippine Chambault"
date: "2022-11-18"
output:
  bookdown::html_document2:
    number_sections: yes
    code_folding: show
    df_print: default
    fig_caption: yes
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo      = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE,
  # cache   = FALSE,
  out.width = "100%"
)
```

```{r, global_options, include=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(raster)
library(viridis)
library(maps)
library(fields)
library(gridExtra)
library(cowplot)
library(tidyquant)
library(scales)
library(marmap)
library(rnaturalearth)
library(rnaturalearthdata)
library(RColorBrewer) 
```

# Ideas for titles
Harbour porpoises synchronize their diving behaviour with the polar night

In the nightscape of the winter Arctic: polar night drives the diving behaviour of harbour porpoises

How daylength shapes the diving behaviour of harbour porpoises in the dark Arctic winter

Why harbour porpoises search for deep and dark waters in the winter Arctic?

Extreme deep dives in a small cetacean are shaped by the boreal nightscape in winter

The polar night shapes the deep diving behaviour of small cetacean, the harbour porpoise

Searching for darkness: how small cetaceans synchronize their dive depth with the Arctic nightscape in winter

Diving into the darkness of the polar night: how harbour porpoises synchronize their dive depth with daylength


# Authors
Philippine Chambault, Outi Tervo, Mads Peter Heide-Jorgensen

# Keywords


# Target journals
PRSB, Current Biology, Functional Ecology, Journal of Animal Ecology



# Table 1
```{r, echo=FALSE, fig.cap="Table 1. Summary of the dive data for the 17 harbour porpoises instrumented in West Greenland. The sparklines refer to the trend of maximum depth and dive duration over time for each individual. The numbers in parenthesis refer to the maximum values for each variable, and the individuals with an asterix (column ID) refer to the tags retrieved and including the high-resolution data.", out.width = '100%'}
knitr::include_graphics("./FIGURES/PAPER/Table1.png")
```


# Figure 0: study area
```{r, echo=FALSE, fig.cap="Fig. 1. Map of the study area including the locations of the 17 individuals instrumented in Maniitsoq. The blue dotted line refers to the Arctic circle.", out.width = '100%'}
knitr::include_graphics("./FIGURES/PAPER/Fig.1.Map.locs.png")
```



# Figure 1
```{r, echo=FALSE, fig.cap="Fig. 1. Density plots showing the diel and seasonal patterns of the mean (top) and maximum (bottom) dive depth recorded by the porpoises. The monthly mean values for day and night are indicated in each panel and are represented by the horizontal dotted lines.", out.width = '100%'}
knitr::include_graphics("./FIGURES/PAPER/Fig.1.png")
```

# Figure 2
```{r, echo=FALSE, fig.cap="Fig. 2. The temporal evolution of (a) dive depth and (b) dive duration for one porpoise instrumented in 2014, and showing the diel and seasonal patterns. Black lines in (a) and (b) refer to the hours of sunrise and sunset. (c) Relationship between the daily mean dive depth and daylength. In (c), the thick line refers to the smooth curve from the GAM including the 13 individuals, while the thin grey lines refer to individual smooth curves.", out.width = '100%'}
knitr::include_graphics("./FIGURES/PAPER/Fig.2.png")
```

# Figure 3
```{r, echo=FALSE, fig.cap="Fig. 3. Density plots of the diving capacities of harbour porpoises' deep dives (> 20 m). Each panel shows the monthly proportions of (a) diurnal and (b) nocturnal deep dives.", out.width = '100%'}
knitr::include_graphics("./FIGURES/PAPER/Fig.3.png")
```


<!-- # SI Figure 1 -->
<!-- ```{r, echo=FALSE, fig.cap="SI Fig. 1. Scatterplots showing the pairwise correlations between each variable. The distribution and correlation coefficients are also shown in each panel.", out.width = '80%'} -->
<!-- knitr::include_graphics("./FIGURES/PAPER/SI.Fig1.png") -->
<!-- ``` -->





# Individual dive profiles {.tabset}
## 22849b
```{r, echo=F}
hp <- readRDS("./RDATA/1b.diveSummary_5HP_calib_5m_zoc0.RDS") %>%
  mutate(date  = as.Date(start),
         month = format(date, "%b"),
         day   = as.numeric(format(date, "%e")))

bathy = raster("./ENV.DATA/GEBCO_Arctic2.nc")
bathy[bathy>=0] = NA
hp$bathy = extract(bathy, hp[,c("lon","lat")])
hp = hp %>%
  mutate(bathy = abs(bathy),
         diff_bathy = bathy - maxdep)

select = hp %>% filter(id == "22849b") 
select$month = factor(select$month, 
                      levels = c("Jul","Aug","Sep","Oct",
                                 "Nov","Dec","Jan"))
max_bathy = 400
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=6, fig.cap="Dive profile over time for #22849b."}
ggplot(select, aes(y=maxdep, x=start)) +
  geom_linerange(aes(ymin = 0, ymax = maxdep, colour=period)) +
  scale_y_continuous(trans = "reverse", expand=c(0,0), 
                     limits=c(max_bathy,0),
                     breaks=c(50,100,200,400)) +
  geom_ribbon(data=select,
              aes(x=start,ymin=bathy,ymax=max_bathy),
              alpha=0.9,fill="grey") +
  scale_x_datetime(breaks = scales::date_breaks("1 day"), 
                   date_labels = "%d/%m", expand=c(0,0)) +
  scale_colour_manual(values = c("lightsalmon","navajowhite1",
                                 "#337882","dodgerblue3")) +
  theme_tq() +
  facet_wrap(~month, ncol=1, scales="free_x") +
  labs(y = "Maximum depth (m)", x = "Date", 
       title="#22849b (F)") +
  theme(legend.position = "bottom",
        legend.key.size = unit(0.8, 'cm'),     #change legend key size
        legend.key.height = unit(0.3, 'cm'),   #change legend key height
        legend.key.width = unit(0.3, 'cm'),    #change legend key width
        legend.text = element_text(size=8),    #change legend text font size
        legend.background = element_blank(),
        legend.key = element_blank(),
        axis.text.x = element_text(size=5, vjust = 0.5, hjust=0.5),
        axis.text.y  = element_text(size=5, hjust=0.5),
        title = element_text(colour="black",size=10,face="bold"),
        plot.title=element_text(size=10, vjust=0, hjust=0, # t r b l
                                colour="black"),
        strip.text = element_text(size=7, colour = "white",
                                  margin = margin(0.5,0.5,0.5,0.5, "mm")),
        strip.background = element_rect(fill = "steelblue4",
                                        colour="white"),
        plot.margin = unit(c(0.2,0.2,0.2,0.1), "cm"),
        panel.border = element_rect(size = 0.2),
        panel.spacing.x = unit(0.0, "lines"),
        panel.spacing.y = unit(0.1, "lines"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())
```



## 22850b
```{r, echo=F}
select = hp %>% filter(id == "22850b") 
select$month = factor(select$month, 
                  levels = c("Jul","Aug","Sep","Oct",
                             "Nov","Dec","Jan"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=6, fig.cap="Dive profile over time for #22850b"}
ggplot(select, aes(y=maxdep, x=start)) +
  geom_linerange(aes(ymin = 0, ymax = maxdep, colour=period)) +
  scale_y_continuous(trans = "reverse", expand=c(0,0), 
                     limits=c(max_bathy,0),
                     breaks=c(50,100,200,300,600)) +
  geom_ribbon(data=select,
              aes(x=start,ymin=bathy,ymax=max_bathy),
              alpha=0.7,fill="grey") +
  scale_x_datetime(breaks = scales::date_breaks("1 day"), 
                   date_labels = "%d/%m", expand=c(0,0)) +
  scale_colour_manual(values = c("lightsalmon","navajowhite1",
                                 "#337882","dodgerblue3")) +
  theme_tq() +
  facet_wrap(~month, ncol=1, scales="free_x") +
  labs(y = "Maximum depth (m)", x = "Date", 
       title="#22850b (F)") +
  theme(legend.position = "bottom",#c(0.05,0.9),
        legend.key.size = unit(0.8, 'cm'),     #change legend key size
        legend.key.height = unit(0.3, 'cm'),   #change legend key height
        legend.key.width = unit(0.3, 'cm'),    #change legend key width
        legend.text = element_text(size=8),    #change legend text font size
        legend.background = element_blank(),
        legend.key = element_blank(),
        axis.text.x = element_text(size=5, vjust = 0.5, hjust=0.5),
        axis.text.y  = element_text(size=5, hjust=0.5),
        title = element_text(colour="black",size=10,face="bold"),
        plot.title=element_text(size=10, vjust=0, hjust=0, # t r b l
                                colour="black"),
        strip.text = element_text(size=7, colour = "white",
                                  margin = margin(0.5,0.5,0.5,0.5, "mm")),
        strip.background = element_rect(fill = "steelblue4",
                                        colour="white"),
        plot.margin = unit(c(0.2,0.2,0.2,0.1), "cm"),
        panel.border = element_rect(size = 0.2),
        panel.spacing.x = unit(0.0, "lines"),
        panel.spacing.y = unit(0.1, "lines"),
        panel.grid.minor = element_blank())
```


## 27262
```{r, echo=F}
select = hp %>% filter(id == "27262") 
select$month = factor(select$month, 
                  levels = c("Jul","Aug","Sep","Oct",
                             "Nov","Dec","Jan"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=6, fig.cap="Dive profile over time for #27262"}
ggplot(select, aes(y=maxdep, x=start)) +
  geom_linerange(aes(ymin = 0, ymax = maxdep, colour=period)) +
  scale_y_continuous(trans = "reverse", expand=c(0,0), 
                     limits=c(max_bathy,0),
                     breaks=c(50,100,200,300,600)) +
  geom_ribbon(data=select,
              aes(x=start,ymin=bathy,ymax=max_bathy),
              alpha=0.7,fill="grey") +
  scale_x_datetime(breaks = scales::date_breaks("1 day"), 
                   date_labels = "%d/%m", expand=c(0,0)) +
  scale_colour_manual(values = c("lightsalmon","navajowhite1",
                                 "#337882","dodgerblue3")) +
  theme_tq() +
  facet_wrap(~month, ncol=1, scales="free_x") +
  labs(y = "Maximum depth (m)", x = "Date", 
       title="#27262 (F)") +
  theme(legend.position = "bottom",
        legend.key.size = unit(0.8, 'cm'),     #change legend key size
        legend.key.height = unit(0.3, 'cm'),   #change legend key height
        legend.key.width = unit(0.3, 'cm'),    #change legend key width
        legend.text = element_text(size=8),    #change legend text font size
        legend.background = element_blank(),
        legend.key = element_blank(),
        axis.text.x = element_text(size=5, vjust = 0.5, hjust=0.5),
        axis.text.y  = element_text(size=5, hjust=0.5),
        title = element_text(colour="black",size=10,face="bold"),
        plot.title=element_text(size=10, vjust=0, hjust=0, # t r b l
                                colour="black"),
        strip.text = element_text(size=7, colour = "white",
                                  margin = margin(0.5,0.5,0.5,0.5, "mm")),
        strip.background = element_rect(fill = "steelblue4",
                                        colour="white"),
        plot.margin = unit(c(0.2,0.2,0.2,0.1), "cm"),
        panel.border = element_rect(size = 0.2),
        panel.spacing.x = unit(0.0, "lines"),
        panel.spacing.y = unit(0.1, "lines"),
        panel.grid.minor = element_blank())
```


## 27262b
```{r, echo=F}
select = hp %>% filter(id == "27262b") 
select$month = factor(select$month, 
                  levels = c("Jul","Aug","Sep","Oct",
                             "Nov","Dec","Jan"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=6, fig.cap="Dive profile over time for #27262b"}
ggplot(select, aes(y=maxdep, x=start)) +
  geom_linerange(aes(ymin = 0, ymax = maxdep, colour=period)) +
  scale_y_continuous(trans = "reverse", expand=c(0,0), 
                     limits=c(max_bathy,0),
                     breaks=c(50,100,200,300,600)) +
  geom_ribbon(data=select,
              aes(x=start,ymin=bathy,ymax=max_bathy),
              alpha=0.7,fill="grey") +
  scale_x_datetime(breaks = scales::date_breaks("1 day"), 
                   date_labels = "%d/%m", expand=c(0,0)) +
  scale_colour_manual(values = c("lightsalmon","navajowhite1",
                                 "#337882","dodgerblue3")) +
  theme_tq() +
  facet_wrap(~month, ncol=1, scales="free_x") +
  labs(y = "Maximum depth (m)", x = "Date", 
       title="#27262b (M)") +
  theme(legend.position = "bottom",
        legend.key.size = unit(0.8, 'cm'),     #change legend key size
        legend.key.height = unit(0.3, 'cm'),   #change legend key height
        legend.key.width = unit(0.3, 'cm'),    #change legend key width
        legend.text = element_text(size=8),    #change legend text font size
        legend.background = element_blank(),
        legend.key = element_blank(),
        axis.text.x = element_text(size=5, vjust = 0.5, hjust=0.5),
        axis.text.y  = element_text(size=5, hjust=0.5),
        title = element_text(colour="black",size=10,face="bold"),
        plot.title=element_text(size=10, vjust=0, hjust=0, # t r b l
                                colour="black"),
        strip.text = element_text(size=7, colour = "white",
                                  margin = margin(0.5,0.5,0.5,0.5, "mm")),
        strip.background = element_rect(fill = "steelblue4",
                                        colour="white"),
        plot.margin = unit(c(0.2,0.2,0.2,0.1), "cm"),
        panel.border = element_rect(size = 0.2),
        panel.spacing.x = unit(0.0, "lines"),
        panel.spacing.y = unit(0.1, "lines"),
        panel.grid.minor = element_blank())
```


## 93100
```{r, echo=F}
select = hp %>% filter(id == "93100") 
select$month = factor(select$month, 
                  levels = c("Jul","Aug","Sep",
                             "Oct","Nov","Dec","Jan"))
```

```{r, echo=FALSE, fig.pos="placeHere", fig.height=6, fig.cap="Dive profile over time for #27262b"}
ggplot(select, aes(y=maxdep, x=start)) +
  geom_linerange(aes(ymin = 0, ymax = maxdep, colour=period)) +
  scale_y_continuous(trans = "reverse", expand=c(0,0), 
                     limits=c(max_bathy,0),
                     breaks=c(50,100,200,300,600)) +
  geom_ribbon(data=select,
              aes(x=start,ymin=bathy,ymax=max_bathy),
              alpha=0.7,fill="grey") +
  scale_x_datetime(breaks = scales::date_breaks("1 day"), 
                   date_labels = "%d/%m", expand=c(0,0)) +
  scale_colour_manual(values = c("lightsalmon","navajowhite1",
                                 "#337882","dodgerblue3")) +
  theme_tq() +
  facet_wrap(~month, ncol=1, scales="free_x") +
  labs(y = "Maximum depth (m)", x = "Date", 
       title="#93100 (M)") +
  theme(legend.position = "bottom",
        legend.key.size = unit(0.8, 'cm'),     #change legend key size
        legend.key.height = unit(0.3, 'cm'),   #change legend key height
        legend.key.width = unit(0.3, 'cm'),    #change legend key width
        legend.text = element_text(size=8),    #change legend text font size
        legend.background = element_blank(),
        legend.key = element_blank(),
        axis.text.x = element_text(size=5, vjust = 0.5, hjust=0.5),
        axis.text.y  = element_text(size=5, hjust=0.5),
        title = element_text(colour="black",size=10,face="bold"),
        plot.title=element_text(size=10, vjust=0, hjust=0, # t r b l
                                colour="black"),
        strip.text = element_text(size=7, colour = "white",
                                  margin = margin(0.5,0.5,0.5,0.5, "mm")),
        strip.background = element_rect(fill = "steelblue4",
                                        colour="white"),
        plot.margin = unit(c(0.2,0.2,0.2,0.1), "cm"),
        panel.border = element_rect(size = 0.2),
        panel.spacing.x = unit(0.0, "lines"),
        panel.spacing.y = unit(0.1, "lines"),
        panel.grid.minor = element_blank())
```